{{- range $key, $value := .Values.operators }}
{{ if eq ($value.enabled | toString) "true" }}
{{ if eq ($value.waitforcheck.create | toString) "true" }}
---
apiVersion: v1
kind: Pod
metadata:
  name: cluster-check 
  namespace: {{ $value.namespace.name | quote }}
  labels:
    {{- include "common.labels" $ | nindent 4 }}
  annotations:
    helm.sh/hook: post-install,post-upgrade
    helm.sh/hook-delete-policy: before-hook-creation,hook-succeeded
    argocd.argoproj.io/sync-options: SkipDryRunOnMissingResource=true
    argocd.argoproj.io/sync-wave: {{ $value.syncwave | default "1" | quote }}
spec:
  containers:
  - name: crd-check 
    image: quay.io/openshift/origin-cli:latest
    imagePullPolicy: IfNotPresent
    command: ['sh', '-c', 'while [ true ]; do oc get crd 
  {{ $value.waitforcheck.crd }}

    ; if [ $? -eq 0 ]; then break; fi ; sleep 5s; done']
  restartPolicy: Never
  terminationGracePeriodSeconds: 0
  serviceAccount: default
  serviceAccountName: default
{{- end }}
{{- end }}
{{- end }}